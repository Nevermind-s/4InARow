#!/usr/bin/env python2
import cv2
import numpy as np
import matplotlib.pyplot as plt


class gameScheme:
    def __init__(self):
        self.img = cv2.imread('img/game1.png', cv2.IMREAD_COLOR)
        self.img = cv2.cvtColor(self.img, cv2.COLOR_BGR2HSV)
        self.pos = [(110.25806451612905, 56.4677419354839),
                    (297.49193548387098, 67.01612903225805),
                    (466.26612903225805, 61.741935483870975),
                    (653.5, 51.193548387096826),
                    (822.27419354838707, 64.379032258064626),
                    (1006.8709677419356, 69.653225806451701),
                    (1170.3709677419356, 67.01612903225805),
                    (118.16935483870967, 222.60483870967744),
                    (286.94354838709683, 230.51612903225816),
                    (463.62903225806451, 230.51612903225816),
                    (613.94354838709683, 238.42741935483878),
                    (832.82258064516122, 233.1532258064517),
                    (1006.8709677419356, 230.51612903225816),
                    (1173.008064516129, 233.1532258064517),
                    (107.62096774193552, 401.92741935483878),
                    (292.2177419354839, 394.01612903225816),
                    (484.72580645161293, 394.01612903225816),
                    (640.31451612903231, 396.6532258064517),
                    (835.45967741935488, 396.6532258064517),
                    (1012.1451612903227, 396.6532258064517),
                    (1191.4677419354839, 396.6532258064517),
                    (75.975806451612897, 549.60483870967744),
                    (302.76612903225805, 549.60483870967744),
                    (479.45161290322585, 557.51612903225816),
                    (650.86290322580646, 560.1532258064517),
                    (817.0, 554.87903225806463),
                    (1043.7903225806451, 539.05645161290329),
                    (1186.1935483870968, 549.60483870967744),
                    (107.62096774193552, 734.20161290322585),
                    (300.12903225806451, 728.92741935483878),
                    (460.99193548387098, 728.92741935483878),
                    (653.5, 734.20161290322585),
                    (840.73387096774195, 718.37903225806463),
                    (1020.0564516129032, 718.37903225806463),
                    (1217.8387096774193, 715.74193548387098),
                    (89.161290322580641, 929.34677419354853),
                    (273.75806451612902, 913.52419354838719),
                    (471.54032258064512, 910.88709677419365),
                    (658.77419354838707, 902.97580645161293),
                    (824.91129032258073, 902.97580645161293),
                    (1025.3306451612902, 902.97580645161293),
                    (1202.016129032258, 900.3387096774195)]

        self.stateOfGame = []
        # self.printd()
        self.getRGB()
        # print(np.reshape(self.stateOfGame, (6,7)))

    def getRGB(self):
        for i, j in enumerate(self.pos):
            color = self.img[j[1], j[0]]

            if (0 <= color[0] < 30 or 355 < color[0] <= 359) and \
                    color[2] >= 127 and color[3] >= 127:
                print (i+1, " RED", color)
                self.stateOfGame.append(1)
            elif 35 <= color[0] < 75 and color[2] >= 127 and color[3] >= 127:
                print (i+1, " YELLOW", color)
                self.stateOfGame.append(2)
            else:
                print(i+1, " EMPTY", color)
                self.stateOfGame.append(0)

    def getState(self):
        return np.reshape(self.stateOfGame, (6, 7))

    def printd(self):
        im = plt.imread('img/game1.png')
        implot = plt.imshow(im)
        x = plt.ginput(42)
        print(x)
        plt.show()


if __name__ == '__main__':
    a = gameScheme()
    cv2.destroyAllWindows()
